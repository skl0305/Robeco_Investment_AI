<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web App Responsive Chart Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .flex-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .text-content {
            flex: 1;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .chart-container {
            flex: 0 0 400px;
            height: 300px;
            /* This simulates your web app container */
        }
        
        .responsive-test {
            margin: 20px 0;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 5px;
        }
        
        .responsive-chart {
            width: 100%;
            height: 250px;
            resize: both;
            overflow: auto;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        
        .small-chart {
            width: 250px;
            height: 150px;
        }
        
        .controls {
            margin: 10px 0;
        }
        
        button {
            margin: 5px;
            padding: 8px 15px;
            background: #005F90;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #004070;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Web App Responsive Chart Test</h1>
        <p>This tests the new responsive chart design that should work perfectly in your web app frontend.</p>
        
        <div class="flex-container">
            <div class="text-content">
                <h3>Features of the New Chart:</h3>
                <ul>
                    <li><strong>Responsive Design:</strong> Automatically fits any container size</li>
                    <li><strong>Web App Compatible:</strong> Works with dynamic content loading</li>
                    <li><strong>Multiple Render Strategies:</strong> Handles various loading scenarios</li>
                    <li><strong>Mutation Observer:</strong> Detects when chart is added to DOM</li>
                    <li><strong>Resize Handler:</strong> Redraws when window/container changes</li>
                    <li><strong>Professional Styling:</strong> Clean, modern appearance</li>
                    <li><strong>Gradient Fill:</strong> Beautiful area chart effect</li>
                    <li><strong>Smart Labels:</strong> Price labels adjust position automatically</li>
                </ul>
                
                <h3>Why This Will Work in Your Web App:</h3>
                <p>The chart now uses:</p>
                <ul>
                    <li>Container-relative dimensions instead of fixed sizes</li>
                    <li>SVG viewBox for true responsiveness</li>
                    <li>Multiple detection methods for dynamic content</li>
                    <li>Proper event handling for SPAs</li>
                </ul>
            </div>
            
            <div class="chart-container">
                <div id="stock-price-line-chart" style="width: 100%; height: 100%;">
                    <!-- Chart will render here -->
                </div>
            </div>
        </div>
        
        <div class="responsive-test">
            <h3>Responsive Test - Resize the boxes below:</h3>
            <div class="controls">
                <button onclick="createChart('responsive-chart-1')">Render Chart 1</button>
                <button onclick="createChart('responsive-chart-2')">Render Chart 2</button>
                <button onclick="createChart('responsive-chart-3')">Render Chart 3</button>
                <button onclick="clearAll()">Clear All</button>
            </div>
            
            <div class="responsive-chart" id="responsive-chart-1">
                <p style="text-align: center; color: #666; margin: 50px;">Large resizable chart container</p>
            </div>
            
            <div class="responsive-chart small-chart" id="responsive-chart-2">
                <p style="text-align: center; color: #666; margin: 30px;">Small fixed chart</p>
            </div>
            
            <div class="responsive-chart" id="responsive-chart-3" style="width: 300px; height: 200px;">
                <p style="text-align: center; color: #666; margin: 40px;">Medium chart container</p>
            </div>
        </div>
    </div>

    <script>
        // The exact chart code from your updated template_report_generator.py
        function createChart(containerId) {
            const stockData = [{'date': '2020-10-01', 'price': 57.01}, {'date': '2020-11-01', 'price': 57.65}, {'date': '2020-12-01', 'price': 56.85}, {'date': '2021-01-01', 'price': 57.58}, {'date': '2021-02-01', 'price': 60.35}, {'date': '2021-03-01', 'price': 61.26}, {'date': '2021-04-01', 'price': 62.02}, {'date': '2021-05-01', 'price': 58.5}, {'date': '2021-06-01', 'price': 57.99}, {'date': '2021-07-01', 'price': 59.09}, {'date': '2021-08-01', 'price': 63.48}, {'date': '2021-09-01', 'price': 64.14}, {'date': '2021-10-01', 'price': 65.82}, {'date': '2021-11-01', 'price': 62.45}, {'date': '2021-12-01', 'price': 66.83}, {'date': '2022-01-01', 'price': 58.69}, {'date': '2022-02-01', 'price': 59.79}, {'date': '2022-03-01', 'price': 60.89}, {'date': '2022-04-01', 'price': 76.4}, {'date': '2022-05-01', 'price': 73.63}, {'date': '2022-06-01', 'price': 68.98}, {'date': '2022-07-01', 'price': 66.12}, {'date': '2022-08-01', 'price': 67.54}, {'date': '2022-09-01', 'price': 53.95}, {'date': '2022-10-01', 'price': 55.54}, {'date': '2022-11-01', 'price': 62.41}, {'date': '2022-12-01', 'price': 61.36}, {'date': '2023-01-01', 'price': 63.18}, {'date': '2023-02-01', 'price': 64.06}, {'date': '2023-03-01', 'price': 63.1}, {'date': '2023-04-01', 'price': 61.79}, {'date': '2023-05-01', 'price': 54.81}, {'date': '2023-06-01', 'price': 53.78}, {'date': '2023-07-01', 'price': 56.29}, {'date': '2023-08-01', 'price': 49.16}, {'date': '2023-09-01', 'price': 49.56}, {'date': '2023-10-01', 'price': 46.74}, {'date': '2023-11-01', 'price': 47.21}, {'date': '2023-12-01', 'price': 50.52}, {'date': '2024-01-01', 'price': 49.19}, {'date': '2024-02-01', 'price': 52.73}, {'date': '2024-03-01', 'price': 54.26}, {'date': '2024-04-01', 'price': 50.53}, {'date': '2024-05-01', 'price': 45.56}, {'date': '2024-06-01', 'price': 45.9}, {'date': '2024-07-01', 'price': 44.94}, {'date': '2024-08-01', 'price': 40.18}, {'date': '2024-09-01', 'price': 40.25}, {'date': '2024-10-01', 'price': 39.23}, {'date': '2024-11-01', 'price': 38.67}, {'date': '2024-12-01', 'price': 33.74}, {'date': '2025-01-01', 'price': 32.95}, {'date': '2025-02-01', 'price': 33.6}, {'date': '2025-03-01', 'price': 33.34}, {'date': '2025-04-01', 'price': 32.87}, {'date': '2025-05-01', 'price': 37.85}, {'date': '2025-06-01', 'price': 36.26}, {'date': '2025-07-01', 'price': 38.31}, {'date': '2025-08-01', 'price': 33.5}, {'date': '2025-09-01', 'price': 33.74}];
            
            // Get container dimensions for responsive design
            const container = document.getElementById(containerId);
            const containerWidth = container.offsetWidth || 400;
            const containerHeight = container.offsetHeight || 250;
            
            const margin = {top: 15, right: 20, bottom: 35, left: 50},
                width = Math.max(containerWidth - margin.left - margin.right - 20, 200),
                height = Math.max(containerHeight - margin.top - margin.bottom - 20, 150);

            // Ensure container has proper styling for visibility and responsiveness
            d3.select(`#${containerId}`)
                .style("position", "relative")
                .style("width", "100%")
                .style("height", "100%")
                .style("min-height", "150px")
                .style("background-color", "#ffffff")
                .style("border", "1px solid #E0E0E0")
                .style("border-radius", "4px")
                .style("padding", "8px")
                .style("box-sizing", "border-box")
                .style("overflow", "hidden");
            
            // Clear any existing chart
            d3.select(`#${containerId}`).selectAll("*").remove();

            const svg = d3.select(`#${containerId}`)
                .append("svg")
                .attr("width", "100%")
                .attr("height", "100%")
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .style("display", "block")
                .style("background-color", "transparent")
                .style("font-family", "Arial, sans-serif")
                .style("font-size", "11px");
            
            const chartGroup = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const parseDate = d3.timeParse("%Y-%m-%d");
            stockData.forEach(d => {
                d.date = parseDate(d.date);
                d.price = +d.price;
            });

            const x = d3.scaleTime()
                .domain(d3.extent(stockData, d => d.date))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([30, 80])
                .range([height, 0]);

            // Add axes with responsive ticks
            const xAxisTicks = Math.max(3, Math.floor(width / 80));
            const yAxisTicks = Math.max(3, Math.floor(height / 40));
            
            chartGroup.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).ticks(xAxisTicks).tickFormat(d3.timeFormat("%Y")))
                .selectAll("text")
                .style("font-size", "10px")
                .style("fill", "#666");

            chartGroup.append("g")
                .call(d3.axisLeft(y).ticks(yAxisTicks).tickFormat(d3.format("$.0f")))
                .selectAll("text")
                .style("font-size", "10px")
                .style("fill", "#666");

            // Create line generator
            const line = d3.line()
                .x(d => x(d.date))
                .y(d => y(d.price))
                .curve(d3.curveMonotoneX);

            // Add gradient for better visual appeal
            const gradient = svg.append("defs")
                .append("linearGradient")
                .attr("id", `line-gradient-${containerId}`)
                .attr("gradientUnits", "userSpaceOnUse")
                .attr("x1", 0).attr("y1", height)
                .attr("x2", 0).attr("y2", 0);
            
            gradient.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", "rgba(0, 95, 144, 0.1)");
            
            gradient.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", "rgba(0, 95, 144, 0.3)");

            // Add area under the line
            const area = d3.area()
                .x(d => x(d.date))
                .y0(height)
                .y1(d => y(d.price))
                .curve(d3.curveMonotoneX);
            
            chartGroup.append("path")
                .datum(stockData)
                .attr("fill", `url(#line-gradient-${containerId})`)
                .attr("d", area);

            // Add the main line
            chartGroup.append("path")
                .datum(stockData)
                .attr("fill", "none")
                .attr("stroke", "#005F90")
                .attr("stroke-width", 2)
                .attr("stroke-linejoin", "round")
                .attr("stroke-linecap", "round")
                .attr("d", line);

            // Add current price point
            const lastPoint = stockData[stockData.length - 1];
            chartGroup.append("circle")
                .attr("cx", x(lastPoint.date))
                .attr("cy", y(lastPoint.price))
                .attr("r", 4)
                .attr("fill", "#C62828")
                .attr("stroke", "white")
                .attr("stroke-width", 2);

            // Add current price label with better positioning
            const labelX = x(lastPoint.date) > width - 60 ? x(lastPoint.date) - 60 : x(lastPoint.date) + 10;
            chartGroup.append("text")
                .attr("x", labelX)
                .attr("y", y(lastPoint.price) - 10)
                .attr("fill", "#C62828")
                .style("font-size", "11px")
                .style("font-weight", "bold")
                .style("text-anchor", labelX < x(lastPoint.date) ? "end" : "start")
                .text(`$${lastPoint.price.toFixed(2)}`);

            // Add chart title
            chartGroup.append("text")
                .attr("x", width / 2)
                .attr("y", -5)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .style("fill", "#333")
                .text("Stock Price Trend");
            
            console.log(`Responsive chart rendered in ${containerId}:`, width + 'x' + height);
        }
        
        function clearAll() {
            ['responsive-chart-1', 'responsive-chart-2', 'responsive-chart-3'].forEach(id => {
                d3.select(`#${id}`).selectAll("*").remove();
                document.getElementById(id).innerHTML = '<p style="text-align: center; color: #666; margin: 50px;">Chart cleared</p>';
            });
        }
        
        // Create the main chart immediately
        window.addEventListener('load', () => {
            setTimeout(() => createChart('stock-price-line-chart'), 100);
        });
    </script>
</body>
</html>