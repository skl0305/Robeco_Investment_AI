<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Line Chart Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        .stock-chart-container {
            width: 100%;
            height: 400px;
            background-color: #f0f0f0;
            border: 2px solid #005F90;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h2>Simple Line Chart Test (Date + Price Only)</h2>
    <div class="stock-chart-container" id="stock-price-line-chart">
        <script type="text/javascript">
            // Ensure D3 is loaded and chart renders properly
            function renderStockChart() {
                if (typeof d3 === 'undefined') {
                    document.getElementById('stock-price-line-chart').innerHTML = '<p style="color: red; padding: 20px;">D3.js library not available. Chart cannot be rendered.</p>';
                    return;
                }
                
                try {
                    // Simplified data structure: only date and price
                    const stockData = [
                        {'date': '2020-01-01', 'price': 57.01},
                        {'date': '2020-02-01', 'price': 58.65},
                        {'date': '2020-03-01', 'price': 55.85},
                        {'date': '2020-04-01', 'price': 59.12},
                        {'date': '2020-05-01', 'price': 61.45},
                        {'date': '2020-06-01', 'price': 62.78}
                    ];
                    
                    const margin = {top: 20, right: 30, bottom: 40, left: 60},
                        width = 500 - margin.left - margin.right,
                        height = 300 - margin.top - margin.bottom;

                    // Clear any existing chart
                    d3.select("#stock-price-line-chart").selectAll("*").remove();

                    const svg = d3.select("#stock-price-line-chart")
                        .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

                    const parseDate = d3.timeParse("%Y-%m-%d");
                    stockData.forEach(d => {
                        d.date = parseDate(d.date);
                        d.price = +d.price;
                    });

                    const x = d3.scaleTime()
                        .domain(d3.extent(stockData, d => d.date))
                        .range([0, width]);

                    const y = d3.scaleLinear()
                        .domain([50, 70])
                        .range([height, 0]);

                    // Add axes
                    svg.append("g")
                        .attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x).ticks(6).tickFormat(d3.timeFormat("%Y-%m")));

                    svg.append("g")
                        .call(d3.axisLeft(y).ticks(6).tickFormat(d3.format("$.2f")));

                    // Create line generator
                    const line = d3.line()
                        .x(d => x(d.date))
                        .y(d => y(d.price))
                        .curve(d3.curveMonotoneX);

                    // Add the line
                    svg.append("path")
                        .datum(stockData)
                        .attr("fill", "none")
                        .attr("stroke", "#005F90")
                        .attr("stroke-width", 2)
                        .attr("d", line);

                    // Add current price point
                    const lastPoint = stockData[stockData.length - 1];
                    svg.append("circle")
                        .attr("cx", x(lastPoint.date))
                        .attr("cy", y(lastPoint.price))
                        .attr("r", 4)
                        .attr("fill", "#C62828");

                    // Add current price label
                    svg.append("text")
                        .attr("x", x(lastPoint.date) + 10)
                        .attr("y", y(lastPoint.price) - 10)
                        .attr("fill", "#C62828")
                        .style("font-size", "12px")
                        .style("font-weight", "bold")
                        .text(`$${lastPoint.price.toFixed(2)}`);
                        
                    console.log('Simple line chart rendered successfully');
                    
                } catch (error) {
                    console.error('Chart rendering error:', error);
                    document.getElementById('stock-price-line-chart').innerHTML = '<p style="color: red; padding: 20px;">Chart rendering failed: ' + error.message + '</p>';
                }
            }
            
            // Try to render immediately, and also when DOM is ready
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(renderStockChart, 100);
            } else {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(renderStockChart, 100);
                });
            }
        </script>
    </div>
    <p>If you see a simple line chart above using only date and price data, the simplified structure is working correctly.</p>
</body>
</html>