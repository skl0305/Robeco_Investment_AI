<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Debug Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        .stock-chart-container {
            width: 100%;
            height: 400px;
            background-color: #f0f0f0;
            border: 2px solid #005F90;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h2>Chart Rendering Test</h2>
    <div class="stock-chart-container" id="stock-price-line-chart">
        <script type="text/javascript">
            // Ensure D3 is loaded and chart renders properly
            function renderStockChart() {
                if (typeof d3 === 'undefined') {
                    document.getElementById('stock-price-line-chart').innerHTML = '<p style="color: red; padding: 20px;">D3.js library not available. Chart cannot be rendered.</p>';
                    return;
                }
                
                try {
                    const stockData = [{'date': '2020-10-01', 'close': 57.01, 'high': 63.94, 'low': 56.34}, {'date': '2020-11-01', 'close': 57.65, 'high': 64.46, 'low': 56.41}, {'date': '2020-12-01', 'close': 56.85, 'high': 59.87, 'low': 56.78}];
                    
                    const margin = {top: 20, right: 30, bottom: 40, left: 60},
                        width = 500 - margin.left - margin.right,
                        height = 300 - margin.top - margin.bottom;

                    // Clear any existing chart
                    d3.select("#stock-price-line-chart").selectAll("*").remove();

                    const svg = d3.select("#stock-price-line-chart")
                        .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                        .append("g")
                        .attr("transform", `translate(${margin.left},${margin.top})`);

                    const parseDate = d3.timeParse("%Y-%m-%d");
                    stockData.forEach(d => {
                        d.date = parseDate(d.date);
                        d.close = +d.close;
                        d.high = +d.high;
                        d.low = +d.low;
                    });

                    const x = d3.scaleTime()
                        .domain(d3.extent(stockData, d => d.date))
                        .range([0, width]);

                    const y = d3.scaleLinear()
                        .domain([50, 70])
                        .range([height, 0]);

                    // Add axes
                    svg.append("g")
                        .attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x).ticks(3));

                    svg.append("g")
                        .call(d3.axisLeft(y).ticks(5));

                    // Create line generator
                    const line = d3.line()
                        .x(d => x(d.date))
                        .y(d => y(d.close))
                        .curve(d3.curveMonotoneX);

                    // Add the line
                    svg.append("path")
                        .datum(stockData)
                        .attr("fill", "none")
                        .attr("stroke", "#005F90")
                        .attr("stroke-width", 2)
                        .attr("d", line);

                    console.log('Test chart rendered successfully');
                    
                } catch (error) {
                    console.error('Chart rendering error:', error);
                    document.getElementById('stock-price-line-chart').innerHTML = '<p style="color: red; padding: 20px;">Chart rendering failed: ' + error.message + '</p>';
                }
            }
            
            // Try to render immediately, and also when DOM is ready
            if (document.readyState === 'complete' || document.readyState === 'interactive') {
                setTimeout(renderStockChart, 100);
            } else {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(renderStockChart, 100);
                });
            }
        </script>
    </div>
    <p>If you see a chart above, the D3.js code is working correctly.</p>
</body>
</html>